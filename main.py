keep_alive()
import os
import re
import random
import datetime
import pytz
import time
import json
import asyncio
from telegram import Update, InlineKeyboardButton, InlineKeyboardMarkup
from telegram.ext import (
BOT_TOKEN = os.getenv("BOT_TOKEN")
    ApplicationBuilder,
    CommandHandler,
    MessageHandler,
    ContextTypes,
    CallbackQueryHandler,
    filters
)

# ---------------------- Web Server ----------------------
from flask import Flask
from threading import Thread

app = Flask('')

@app.route('/')
def home():
    return "Bot is running!"

def run():
    app.run(host='0.0.0.0', port=8080)

def keep_alive():
    t = Thread(target=run)
    t.start()

# ---------------------- Global Variables ----------------------
reminders = {}
user_points = {}
user_activities = {}
last_questions = {}
active_champs = {}
MENTION_USERS = [
    "@Mohammed_f404",
    "@LazyTurtle1",
    "@HaiderAli10",
    "@specter90",
    "@Tigermasko",
    "@Hrain3000",
    "@Alm0btaker",
    "@Hamooor16",
    "@ZoRo_Gamer10",
    "@Xatheo",
    "@Namo0r_Hussain",
    "@SayedMxhammed"
]


# ---------------------- Helper Functions ----------------------

def shuffle_question_options(questions):
    """Shuffle options for each question and update correct answer index"""
    import random

    shuffled_questions = []
    for q in questions:
        # Create copy of original question
        new_q = q.copy()

        # Get correct answer text
        correct_answer = q['options'][q['correct']]

        # Create list of options with their indices
        options_with_index = list(enumerate(q['options']))

        # Shuffle the options
        random.shuffle(options_with_index)

        # Update options and correct index
        new_options = []
        for i, (_, opt) in enumerate(options_with_index):
            new_options.append(opt)
            if opt == correct_answer:
                new_q['correct'] = i

        new_q['options'] = new_options
        shuffled_questions.append(new_q)

    return shuffled_questions
# ---------------------- Custom Messages ----------------------
MENTION_PHRASES = [
    "هلوووووووووووووووووووووووووووووووووووووو {users}",
    "تعالووووووووووووووووووووووووووووووووووووووووووووووووووو {users}",
    "شكد نايمين؟ {users}",
    "وينكم حبايبي؟ {users}",
    "تعالو سوالف {users}",
    "شباب تعالو ضروري {users}",
    "يا جماعة الخير {users}",
    "وين راحتكم؟ {users}",
    "تعالو عندي خبر {users}",
    "شكد صاملين؟ {users}",
    "يا حلوين {users} وينكم؟",
    "هسة مين موجود؟ {users}",
    "تعالو نبلش {users}",
    "شباب {users} ساعدوني",
    "وين الكل؟ {users}",
    "تعالو نلعب {users}",
    "يا جماعة {users} عندي سؤال",
    "وين المتفاعلين؟ {users}",
    "تعالو نتفلسف {users}",
    "شباب {users} عندي فكرة"
]

CORRECT_ANSWER_PHRASES = [
    "أحسنت! 🌟",
    "جان صح، شاطر! 🤩",  # عراقي
    "والله زين منك! 👏", # حساوي
    "اوووه، تستاهل! 💫", # قطيفي
    "عفية عليك! 🎯", # عراقي
    "كفوو والله! 💯", # حساوي
    "يالحبيب مضبوط! ✨", # قطيفي
    "هيج هيج، عاشت ايدك! 🎊", # عراقي
    "منور يالغالي! 🌟", # حساوي
    "يا سلااام عليك! 👑", # قطيفي
    "شنو هالذكاء! 🧠", # عراقي
    "ما شاء الله تبارك الله! 💫", # حساوي
    "يعطيك العافية يالنشمي! ⭐", # قطيفي
    "حلاوة، تستاهل بوسة! 💝", # عراقي
    "فديت هالعقل! 🎈" # حساوي
]

WRONG_ANSWER_PHRASES = [
    "للأسف الإجابة خاطئة ❌",
    "لا حبيبي، حاول مرة ثانية! 😅", # حساوي
    "شعليك، المرة الجاية! 🚫", # عراقي
    "يا غناتي مو صح! 💔", # قطيفي
    "خطية، قريب من الإجابة! 🎯", # عراقي
    "حظ أوفر المرة الجاية! 🍀", # حساوي
    "لا يا عيني، مو هذي! 😊", # قطيفي
    "دير بالك زين! 👀", # عراقي
    "افا، كان عندك غيرها! 🌟", # حساوي
    "يا حسرة، طلعت غلط! 💫", # قطيفي
    "شكو، وين رايح؟ 😅", # عراقي
    "لا تشيل هم، جرب مرة ثانية! 🎈", # حساوي
    "خلاص ما عليه، حاول بعد! ⭐", # قطيفي
    "بعد ماكو، غير هذي! 🎯", # عراقي
    "يالله مرة ثانية! 💪" # حساوي
]

# ---------------------- MCQ Questions ----------------------
MCQ_QUESTIONS = [
    {
        'question': "ما هي عاصمة فرنسا؟",
        'options': ["لندن", "باريس", "برلين", "مدريد"],
        'correct': 1,
        'category': "جغرافي"
    },
    {
        "question": "من هو أول إمام عند الشيعة؟",
        "options": ["الإمام علي بن أبي طالب", "الإمام الحسين", "الإمام جعفر الصادق", "الإمام موسى الكاظم"],
        "correct": 0,
        "category": "ديني"
    },
    {
        "question": "ما هي عاصمة العراق؟",
        "options": ["البصرة", "بغداد", "الموصل", "النجف"],
        "correct": 1,
        "category": "جغرافي"
    },
    {
        "question": "من هو مؤلف كتاب نهج البلاغة؟",
        "options": ["الشريف الرضي", "العلامة الحلي", "الشيخ الطوسي", "الشيخ المفيد"],
        "correct": 0,
        "category": "ديني"
    },
    {
        "question": "كم عدد الكواكب في المجموعة الشمسية؟",
        "options": ["7", "8", "9", "10"],
        "correct": 1,
        "category": "علمي"
    },
    {
        "question": "أين يقع مرقد الإمام الحسين (ع)؟",
        "options": ["النجف", "كربلاء", "الكاظمية", "سامراء"],
        "correct": 1,
        "category": "ديني"
    },
    {
        "question": "من هو أطول نهر في العالم؟",
        "options": ["نهر النيل", "نهر الأمازون", "نهر دجلة", "نهر الفرات"],
        "correct": 0,
        "category": "جغرافي"
    },
    {
        "question": "ما هو المعدن الذي يستخدم في صناعة البطاريات؟",
        "options": ["الحديد", "الليثيوم", "الذهب", "النحاس"],
        "correct": 1,
        "category": "علمي"
    },
    {
        "question": "في أي سنة ولد الإمام علي (ع)؟",
        "options": ["600 ميلادي", "601 ميلادي", "599 ميلادي", "603 ميلادي"],
        "correct": 2,
        "category": "ديني"
    },
    {
        "question": "ما هي أكبر دولة عربية من حيث المساحة؟",
        "options": ["العراق", "السعودية", "الجزائر", "مصر"],
        "correct": 2,
        "category": "جغرافي"
    },
    {
        "question": "من هو الإمام الذي لقب بالكاظم؟",
        "options": ["الإمام محمد الباقر", "الإمام جعفر الصادق", "الإمام موسى الكاظم", "الإمام علي الرضا"],
        "correct": 2,
        "category": "ديني"
    },
    {
        "question": "ما هي العاصمة التاريخية للدولة العباسية؟",
        "options": ["بغداد", "دمشق", "القاهرة", "الكوفة"],
        "correct": 0,
        "category": "ثقافي"
    },
    {
        "question": "كم عدد أئمة الشيعة الاثني عشرية؟",
        "options": ["10", "12", "14", "7"],
        "correct": 1,
        "category": "ديني"
    },
    {
        "question": "أي عنصر كيميائي يحمل الرمز O؟",
        "options": ["الأوزون", "الأكسجين", "الذهب", "الأوكتان"],
        "correct": 1,
        "category": "علمي"
    },
    {
        "question": "ما هو الجبل الأعلى في العالم؟",
        "options": ["جبل إيفرست", "جبل كليمنجارو", "جبل قاف", "جبل الألب"],
        "correct": 0,
        "category": "جغرافي"
    },
    {
        "question": "من هو الإمام المهدي عند الشيعة؟",
        "options": ["الإمام الثاني عشر", "الإمام الحادي عشر", "الإمام العاشر", "الإمام التاسع"],
        "correct": 0,
        "category": "ديني"
    },
    {
        "question": "ما هي اللغة الرسمية في البرازيل؟",
        "options": ["الإسبانية", "البرتغالية", "الإنجليزية", "الفرنسية"],
        "correct": 1,
        "category": "ثقافي"
    },
    {
        "question": "متى وقعت معركة كربلاء؟",
        "options": ["10 محرم 61 هـ", "10 محرم 60 هـ", "10 صفر 61 هـ", "10 محرم 62 هـ"],
        "correct": 0,
        "category": "ديني"
    },
    {
        "question": "ما هي عاصمة اليابان؟",
        "options": ["سيول", "طوكيو", "بكين", "بانكوك"],
        "correct": 1,
        "category": "جغرافي"
    },
    {
        "question": "من هو الصحابي الذي لقب بأسد الله؟",
        "options": ["حمزة بن عبد المطلب", "علي بن أبي طالب", "خالد بن الوليد", "أبو ذر الغفاري"],
        "correct": 0,
        "category": "ديني"
    },
    {
        "question": "كم عدد الدول العربية؟",
        "options": ["20", "22", "18", "24"],
        "correct": 1,
        "category": "جغرافي"
    },
    {
        "question": "من هو مؤسس علم الكيمياء الحديث؟",
        "options": ["ابن سينا", "جابر بن حيان", "الخوارزمي", "أنطوان لافوازييه"],
        "correct": 3,
        "category": "علمي"
    },
    {
        "question": "ما هي السورة التي تعادل ثلث القرآن؟",
        "options": ["سورة الإخلاص", "سورة الفاتحة", "سورة يس", "سورة الكوثر"],
        "correct": 0,
        "category": "ديني"
    },
    {
        "question": "متى تأسست منظمة الأمم المتحدة؟",
        "options": ["1945", "1950", "1940", "1955"],
        "correct": 0,
        "category": "ثقافي"
    },
    {
        "question": "ما هو الحيوان الذي يستطيع أن يدير رأسه 270 درجة؟",
        "options": ["النسر", "البومة", "التمساح", "الزرافة"],
        "correct": 1,
        "category": "علمي"
    }, {
        "question": "ما هو العنصر الذي يرمز له بالرمز 'Na'؟",
        "options": ["نيتروجين", "صوديوم", "نحاس", "نيون"],
        "correct": 1,
        "category": "علمي"
    },
    {
        "question": "من هو الإمام الذي كتب نهج البلاغة؟",
        "options": ["الإمام الحسن", "الإمام الحسين", "الإمام علي", "الإمام الجواد"],
        "correct": 2,
        "category": "ديني"
    }, {
        "question": "من هو الإمام المعصوم الذي كتب رسالة الحقوق؟",
        "options": ["الإمام علي", "الإمام السجاد", "الإمام الكاظم", "الإمام الباقر"],
        "correct": 1,
        "category": "ديني"
    },
    {
        "question": "أي العناصر التالية يُعد من الفلزات القلوية؟",
        "options": ["النيتروجين", "الكالسيوم", "الصوديوم", "الكلور"],
        "correct": 2,
        "category": "علمي"
    },
    {
        "question": "ما هي الدولة التي تقع فيها صحراء أتاكاما؟",
        "options": ["بيرو", "تشيلي", "الأرجنتين", "بوليفيا"],
        "correct": 1,
        "category": "جغرافي"
    },
    {
        "question": "ما هو اسم أقدم جامعة في العالم؟",
        "options": ["السوربون", "أوكسفورد", "القرويين", "هارفارد"],
        "correct": 2,
        "category": "ثقافي"
    },
    {
        "question": "ما هو تعريف علم الأصول في المذهب الشيعي؟",
        "options": ["علم الفقه", "علم يبحث في الأدلة الشرعية", "علم العقائد", "علم الحديث"],
        "correct": 1,
        "category": "ديني"
    },
    {
        "question": "أي جزء من الدماغ مسؤول عن التوازن؟",
        "options": ["المخيخ", "النخاع المستطيل", "القشرة الدماغية", "الدماغ الأوسط"],
        "correct": 0,
        "category": "علمي"
    },
    {
        "question": "ما هي العاصمة التي تقع على نهر الدانوب؟",
        "options": ["فيينا", "أثينا", "بوخارست", "براغ"],
        "correct": 0,
        "category": "جغرافي"
    },
    {
        "question": "من هو مؤلف كتاب كليلة ودمنة؟",
        "options": ["الجاحظ", "ابن المقفع", "ابن خلدون", "المعري"],
        "correct": 1,
        "category": "ثقافي"
    },
    {
        "question": "في أي سورة ذُكرت آية التطهير؟",
        "options": ["الأحزاب", "الأنفال", "المائدة", "النساء"],
        "correct": 0,
        "category": "ديني"
    },
    {
        "question": "ما هو الغاز المسؤول عن الرائحة في البيض الفاسد؟",
        "options": ["ثاني أكسيد الكربون", "الميثان", "الهيدروجين", "كبريتيد الهيدروجين"],
        "correct": 3,
        "category": "علمي"
    },

    {
        "question": "من هو أول فقيه شيعي صنّف كتابًا في علم الرجال؟",
        "options": ["النجاشي", "الشيخ الطوسي", "الكشي", "ابن الغضائري"],
        "correct": 2,
        "category": "ديني"
    },
    {
        "question": "ما هو العنصر الذي يدخل في تركيب الهيموغلوبين؟",
        "options": ["الكالسيوم", "الحديد", "النحاس", "الفسفور"],
        "correct": 1,
        "category": "علمي"
    },
    {
        "question": "ما هي الدولة التي تمتلك أكبر عدد من الجزر؟",
        "options": ["السويد", "المالديف", "اليابان", "إندونيسيا"],
        "correct": 0,
        "category": "جغرافي"
    },
    {
        "question": "من هو الفيلسوف الذي يُنسب له كتاب “إحياء علوم الدين”؟",
        "options": ["الفارابي", "الغزالي", "ابن رشد", "الكندي"],
        "correct": 1,
        "category": "ثقافي"
    },
    {
        "question": "من هو الإمام الذي ناظر الزنادقة في عصره؟",
        "options": ["الإمام الصادق", "الإمام الكاظم", "الإمام الرضا", "الإمام الباقر"],
        "correct": 2,
        "category": "ديني"
    },
    {
        "question": "كم عدد عظام الإنسان البالغ؟",
        "options": ["206", "210", "201", "215"],
        "correct": 0,
        "category": "علمي"
    },
    {
        "question": "ما هي الدولة التي كانت تُعرف سابقًا باسم سيام؟",
        "options": ["تايلاند", "فيتنام", "كمبوديا", "لاوس"],
        "correct": 0,
        "category": "جغرافي"
    },
    {
        "question": "ما هو الكتاب الذي يُعد من أوائل كتب النحو العربي؟",
        "options": ["الكتاب", "الألفية", "البيان والتبيين", "دلائل الإعجاز"],
        "correct": 0,
        "category": "ثقافي"
    },
    {
        "question": "في أي كتاب وردت رواية حديث الكساء؟",
        "options": ["الكافي", "البحار", "عيون أخبار الرضا", "الأمالي"],
        "correct": 0,
        "category": "ديني"
    },
    {
        "question": "أي نوع من الخلايا ينتج الأجسام المضادة؟",
        "options": ["الخلايا التائية", "الخلايا البائية", "الصفائح الدموية", "خلايا الدم الحمراء"],
        "correct": 1,
        "category": "علمي"
    },
    {
        "question": "أين تقع بحيرة تيتيكاكا؟",
        "options": ["تشيلي", "البرازيل", "بيرو", "كولومبيا"],
        "correct": 2,
        "category": "جغرافي"
    },
    {
        "question": "ما اسم الشاعر الذي قيل عنه “ملأ الدنيا وشغل الناس”؟",
        "options": ["المتنبي", "الفرزدق", "جرير", "زهير بن أبي سلمى"],
        "correct": 0,
        "category": "ثقافي"
    },
    {
        "question": "ما معنى الإمامة عند الشيعة الإمامية؟",
        "options": ["القيادة السياسية", "النبوة", "الخلافة الظاهرية", "القيادة الدينية المعصومة"],
        "correct": 3,
        "category": "ديني"
    },
    {
        "question": "ما هي وحدة قياس الشحنة الكهربائية؟",
        "options": ["الأوم", "الفولت", "الكولوم", "الأمبير"],
        "correct": 2,
        "category": "علمي"
    },
    {
        "question": "ما هي عاصمة كازاخستان؟",
        "options": ["ألما آتا", "نور سلطان", "طشقند", "بشكيك"],
        "correct": 1,
        "category": "جغرافي"
    },
    {
        "question": "من هو صاحب كتاب “مقدمة في المنطق”؟",
        "options": ["أرسطو", "أفلاطون", "ابن سينا", "الفارابي"],
        "correct": 0,
        "category": "ثقافي"
    },
    {
        "question": "من هو الإمام الذي كانت ولادته ووفاته في المدينة؟",
        "options": ["الإمام الباقر", "الإمام الصادق", "الإمام السجاد", "الإمام الحسن العسكري"],
        "correct": 1,
        "category": "ديني"
    },
    {
        "question": "ما اسم العملية التي تتحول فيها المادة من الحالة الصلبة إلى الغازية مباشرة؟",
        "options": ["التسامي", "التبخر", "التكاثف", "الانصهار"],
        "correct": 0,
        "category": "علمي"
    },
    {
        "question": "ما هي الدولة التي تحد الصين من الجنوب؟",
        "options": ["منغوليا", "الهند", "كوريا الجنوبية", "تايلاند"],
        "correct": 1,
        "category": "جغرافي"
    },
    {
        "question": "من أول من أنشأ علم العَروض؟",
        "options": ["الأخفش", "الخليل بن أحمد", "سيبويه", "الفراء"],
        "correct": 1,
        "category": "ثقافي"
    },
    {
        "question": "كم عدد الكتب الأربعة عند الشيعة؟",
        "options": ["ثلاثة", "أربعة", "خمسة", "ستة"],
        "correct": 1,
        "category": "ديني"
    },
    {
        "question": "في أي جزء من الخلية توجد الميتوكوندريا؟",
        "options": ["النواة", "السيتوبلازم", "الغشاء البلازمي", "جهاز جولجي"],
        "correct": 1,
        "category": "علمي"
    },
    {
        "question": "ما هي عاصمة النيجر؟",
        "options": ["نيامي", "لاغوس", "باماكو", "أبوجا"],
        "correct": 0,
        "category": "جغرافي"
    },
    {
        "question": "ما معنى كلمة “هرم” في اللغة المصرية القديمة؟",
        "options": ["الملك", "الضوء", "العلو", "المكان المرتفع"],
        "correct": 2,
        "category": "ثقافي"
    },
    {
        "question": "ما اسم كتاب السيد الخوئي في علم الرجال؟",
        "options": ["معجم رجال الحديث", "رجال الطوسي", "الفهرست", "الرجال الكبير"],
        "correct": 0,
        "category": "ديني"
    },
    {
        "question": "أي العمليات التالية تحدث في الأمعاء الدقيقة؟",
        "options": ["الهضم الميكانيكي", "امتصاص الماء", "امتصاص الغذاء المهضوم", "إنتاج العصارات الهاضمة"],
        "correct": 2,
        "category": "علمي"
    },
    {
        "question": "ما هي أكبر دولة في أمريكا الوسطى؟",
        "options": ["كوستاريكا", "غواتيمالا", "هندوراس", "نيكاراغوا"],
        "correct": 3,
        "category": "جغرافي"
    },
    {
        "question": "ما اسم الخط الذي كتب به القرآن الكريم أول مرة؟",
        "options": ["النسخ", "الكوفي", "الديواني", "الرقعة"],
        "correct": 1,
        "category": "ثقافي"
    },
    {
        "question": "من هو الإمام الذي عاش أطول مدة إمامة؟",
        "options": ["الإمام الرضا", "الإمام الصادق", "الإمام الباقر", "الإمام المهدي"],
        "correct": 3,
        "category": "ديني"
    },
    {
        "question": "ما هو عدد الكروموسومات في الخلية البشرية؟",
        "options": ["42", "44", "46", "48"],
        "correct": 2,
        "category": "علمي"
    },
    {
        "question": "ما اسم المضيق الذي يفصل أوروبا عن إفريقيا؟",
        "options": ["باب المندب", "هرمز", "جبل طارق", "البوسفور"],
        "correct": 2,
        "category": "جغرافي"
    },
    {
        "question": "من هو صاحب ديوان “الديوان الكبير”؟",
        "options": ["أبو العلاء المعري", "ابن الفارض", "المتنبي", "أحمد شوقي"],
        "correct": 2,
        "category": "ثقافي"
    },
    {
        "question": "من هو أول شهيد في كربلاء من بني هاشم؟",
        "options": ["العباس", "علي الأكبر", "مسلم بن عقيل", "القاسم بن الحسن"],
        "correct": 1,
        "category": "ديني"
    },
    {
        "question": "أي جزء من النبات يقوم بعملية البناء الضوئي؟",
        "options": ["الساق", "الزهرة", "الجذر", "الورقة"],
        "correct": 3,
        "category": "علمي"
    },
    {
        "question": "ما هي أكبر بحيرة في العالم من حيث المساحة؟",
        "options": ["بحر قزوين", "بحيرة سوبيريور", "بحيرة فيكتوريا", "بحيرة بايكال"],
        "correct": 0,
        "category": "جغرافي"
    },
    {
        "question": "ما معنى كلمة “ديوان” في التراث العربي؟",
        "options": ["مجموعة من القصائد", "مجلس القضاة", "أرشيف الكتب", "سجل الضرائب"],
        "correct": 0,
        "category": "ثقافي"
    },
    {
        "question": "في أي سنة وُلد الإمام الحسين عليه السلام؟",
        "options": ["3 هـ", "4 هـ", "5 هـ", "6 هـ"],
        "correct": 2,
        "category": "ديني"
    },
    {
        "question": "ما هو العضو المسؤول عن إنتاج الإنسولين؟",
        "options": ["الكبد", "المعدة", "البنكرياس", "الطحال"],
        "correct": 2,
        "category": "علمي"
    },
    {
        "question": "ما هي الدولة التي توجد فيها مدينة براغ؟",
        "options": ["سلوفاكيا", "النمسا", "التشيك", "بولندا"],
        "correct": 2,
        "category": "جغرافي"
    },
    {
        "question": "من هو مؤلف كتاب “العقد الفريد”؟",
        "options": ["ابن عبد ربه", "الزهري", "ابن المقفع", "ابن هشام"],
        "correct": 0,
        "category": "ثقافي"
    }, {
        "question": "ما هو العصب المسؤول عن حركة عضلات الوجه؟",
        "options": ["العصب الوجهي", "العصب الثلاثي التوائم", "العصب البصري", "العصب السمعي"],
        "correct": 0,
        "category": "علمي"
    },
    {
        "question": "في أي جزء من الخلية تحدث عملية التنفس الخلوي؟",
        "options": ["الميتوكوندريا", "السيتوبلازم", "النواة", "الريبوسومات"],
        "correct": 0,
        "category": "علمي"
    },
    {
        "question": "من هو النبي الذي دُفن في النجف الأشرف؟",
        "options": ["النبي آدم", "النبي نوح", "النبي هود", "النبي صالح"],
        "correct": 0,
        "category": "ديني"
    },
    {
        "question": "من هو العالم الشيعي المعروف بـ \"الشيخ المفيد\"؟",
        "options": ["محمد بن النعمان", "الشيخ الطوسي", "العلامة الحلي", "الصدوق"],
        "correct": 0,
        "category": "ديني"
    },
    {
        "question": "كم عدد الأحماض الأمينية الأساسية في جسم الإنسان؟",
        "options": ["9", "12", "20", "6"],
        "correct": 0,
        "category": "علمي"
    },
    {
        "question": "في أي قارة تقع هضبة التبت؟",
        "options": ["آسيا", "أفريقيا", "أوروبا", "أمريكا الجنوبية"],
        "correct": 0,
        "category": "جغرافي"
    },
    {
        "question": "ما اسم أول كتاب كتب في علم أصول الفقه الشيعي؟",
        "options": ["العدة", "الذريعة", "الكافي", "الاستبصار"],
        "correct": 0,
        "category": "ديني"
    },
    {
        "question": "أي الغدد التالية مسؤولة عن تنظيم الأيض؟",
        "options": ["الغدة الدرقية", "الغدة الكظرية", "الغدة النخامية", "الغدة اللعابية"],
        "correct": 0,
        "category": "علمي"
    },
    {
        "question": "في أي مادة منطقية يستخدم مصطلح \"الحد الأوسط\"؟",
        "options": ["القياس", "الاستقراء", "التمثيل", "العكس المستوي"],
        "correct": 0,
        "category": "ديني"
    },
    {
        "question": "ما هي صيغة الماء الثقيل؟",
        "options": ["D2O", "H2O2", "H3O+", "OH-"],
        "correct": 0,
        "category": "علمي"
    },
    {
        "question": "أين يقع المسجد الأموي؟",
        "options": ["دمشق", "الكوفة", "المدينة المنورة", "بغداد"],
        "correct": 0,
        "category": "جغرافي"
    },
    {
        "question": "ما هو تعريف التعادل في علم الكيمياء؟",
        "options": ["تفاعل حمض وقاعدة", "نقطة غليان الماء", "ثابت الاتزان", "الإلكترونات المفقودة"],
        "correct": 0,
        "category": "علمي"
    },
    {
        "question": "من هو مؤلف كتاب \"نهج البلاغة\"؟",
        "options": ["الشريف الرضي", "الكليني", "ابن بابويه", "الشيخ الطوسي"],
        "correct": 0,
        "category": "ديني"
    },
    {
        "question": "كم عدد أزواج الكروموسومات في الإنسان؟",
        "options": ["23", "46", "22", "24"],
        "correct": 0,
        "category": "علمي"
    },
    {
        "question": "ما هو أعلى جبل في قارة أفريقيا؟",
        "options": ["كليمنجارو", "الأطلس", "كينيا", "إلبرس"],
        "correct": 0,
        "category": "جغرافي"
    },
    {
        "question": "ما اسم المعركة التي استشهد فيها الإمام الحسين؟",
        "options": ["كربلاء", "صفين", "النهروان", "الجمل"],
        "correct": 0,
        "category": "ديني"
    },
    {
        "question": "ما هي وحدة قياس التيار الكهربائي؟",
        "options": ["أمبير", "فولت", "وات", "أوم"],
        "correct": 0,
        "category": "علمي"
    },
    {
        "question": "ما هو المقصود بمبدأ العلية في علم المنطق؟",
        "options": ["كل حادث له سبب", "كل فعل له نتيجة", "لكل قضية نقيض", "الجزء أصغر من الكل"],
        "correct": 0,
        "category": "ديني"
    },
    {
        "question": "أين تقع مدينة النجف؟",
        "options": ["العراق", "إيران", "سوريا", "البحرين"],
        "correct": 0,
        "category": "جغرافي"
    },
    {
        "question": "ما هو اسم الطور الذي تنقسم فيه الخلية لتكوين خليتين؟",
        "options": ["الانقسام المتساوي", "التحلل المائي", "التضاعف", "التنفس الخلوي"],
        "correct": 0,
        "category": "علمي"
    }, {
        "question": "من هو الإمام الذي كتب رسالة الحقوق؟",
        "options": ["الإمام زين العابدين", "الإمام الباقر", "الإمام الصادق", "الإمام الحسن"],
        "correct": 0,
        "category": "ديني"
    },
    {
        "question": "ما هي قاعدة اليد في الفقه الجعفري؟",
        "options": ["اليد أمارة على الملك", "اليد تنقض الشهادة", "اليد لا تقطع إلا بيقين", "اليد لا تدل على شيء"],
        "correct": 0,
        "category": "ديني"
    },
    {
        "question": "أي عنصر كيميائي رمزه Fe؟",
        "options": ["الحديد", "النحاس", "الفلور", "الزنك"],
        "correct": 0,
        "category": "علمي"
    },
    {
        "question": "أين تقع بحيرة بايكال؟",
        "options": ["روسيا", "الصين", "كندا", "منغوليا"],
        "correct": 0,
        "category": "جغرافي"
    },
    {
        "question": "ما هو العضو الذي يضخ الدم في الجسم؟",
        "options": ["القلب", "الكبد", "الرئتان", "الطحال"],
        "correct": 0,
        "category": "علمي"
    },
    {
        "question": "في أي معركة استشهد الإمام علي عليه السلام؟",
        "options": ["لم يستشهد في معركة بل اغتيل", "صفين", "النهروان", "الجمل"],
        "correct": 0,
        "category": "ديني"
    },
    {
        "question": "ما هو عدد الكواكب في النظام الشمسي؟",
        "options": ["8", "9", "7", "10"],
        "correct": 0,
        "category": "علمي"
    },
    {
        "question": "أي المناطق التالية تقع في شبه الجزيرة العربية؟",
        "options": ["نجد", "الأندلس", "الهلال الخصيب", "الأناضول"],
        "correct": 0,
        "category": "جغرافي"
    },
    {
        "question": "من هو صاحب كتاب الكافي؟",
        "options": ["الكليني", "الصدوق", "الطوسي", "المرتضى"],
        "correct": 0,
        "category": "ديني"
    },
    {
        "question": "ما هو عدد عظام جسم الإنسان البالغ؟",
        "options": ["206", "210", "208", "201"],
        "correct": 0,
        "category": "علمي"
    },
    {
        "question": "ما هي أصغر وحدة في المادة الحية؟",
        "options": ["الخلية", "الجزيء", "البروتون", "الذرة"],
        "correct": 0,
        "category": "علمي"
    },
    {
        "question": "أين يقع قبر السيدة فاطمة المعصومة؟",
        "options": ["قم", "النجف", "الكاظمية", "مشهد"],
        "correct": 0,
        "category": "ديني"
    },
    {
        "question": "من هو الإمام الذي لقب بـ 'باقر العلوم'؟",
        "options": ["الإمام محمد الباقر", "الإمام جعفر الصادق", "الإمام علي", "الإمام الحسين"],
        "correct": 0,
        "category": "ديني"
    },
    {
        "question": "أي مما يلي لا يعد من خصائص المعادن؟",
        "options": ["انعدام التوصيل الكهربائي", "البريق", "الصلابة", "التوصيل الحراري"],
        "correct": 0,
        "category": "علمي"
    },
    {
        "question": "ما هو الغاز الذي يُستخدم في إطفاء الحرائق؟",
        "options": ["ثاني أكسيد الكربون", "الأكسجين", "الهيليوم", "الهيدروجين"],
        "correct": 0,
        "category": "علمي"
    },
    {
        "question": "من هو مؤسس علم أصول الفقه الشيعي؟",
        "options": ["الشافعي", "الإمام الباقر", "الشيخ المفيد", "الشيخ الطوسي"],
        "correct": 2,
        "category": "ديني"
    },
    {
        "question": "في أي قارة تقع جبال الأنديز؟",
        "options": ["أمريكا الجنوبية", "أفريقيا", "آسيا", "أوروبا"],
        "correct": 0,
        "category": "جغرافي"
    },
    {
        "question": "ما هو العضو المسؤول عن تنقية الدم من السموم؟",
        "options": ["الكبد", "القلب", "الرئة", "المعدة"],
        "correct": 0,
        "category": "علمي"
    },
    {
        "question": "ما اسم العملية التي ينتج فيها النبات غذاءه؟",
        "options": ["التمثيل الضوئي", "التنفس الخلوي", "النقل النشط", "البناء البروتيني"],
        "correct": 0,
        "category": "علمي"
    },
    {
        "question": "أي من الآتي يُعتبر شرطًا لصحة الصلاة في الفقه الشيعي؟",
        "options": ["الطهارة", "الوقوف طويلاً", "أن تكون في البيت", "الصيام"],
        "correct": 0,
        "category": "ديني"
    },
    {
        "question": "في أي قارة تقع دولة كازاخستان؟",
        "options": ["آسيا", "أوروبا", "أفريقيا", "أمريكا الشمالية"],
        "correct": 0,
        "category": "جغرافي"
    },
    {
        "question": "من هو صاحب كتاب من لا يحضره الفقيه؟",
        "options": ["ابن بابويه الصدوق", "الكليني", "الطوسي", "الشريف المرتضى"],
        "correct": 0,
        "category": "ديني"
    },
    {
        "question": "ما هي وحدة قياس المقاومة الكهربائية؟",
        "options": ["أوم", "أمبير", "فولت", "واط"],
        "correct": 0,
        "category": "علمي"
    },
    {
        "question": "ما هو الحيوان الذي يستخدم اللسان لالتقاط الطعام كليًا؟",
        "options": ["الحرباء", "الأسد", "التمساح", "النسر"],
        "correct": 0,
        "category": "علمي"
    },
    {
        "question": "في أي بلد تقع مدينة قُم؟",
        "options": ["إيران", "العراق", "سوريا", "لبنان"],
        "correct": 0,
        "category": "جغرافي"
    },
    {
        "question": "من هو الإمام الذي كان يُلقب بـ 'باب الحوائج'؟",
        "options": ["الإمام موسى الكاظم", "الإمام علي", "الإمام الرضا", "الإمام زين العابدين"],
        "correct": 0,
        "category": "ديني"
    },
    {
        "question": "أي مما يلي يُعد حمضًا؟",
        "options": ["HCl", "NaOH", "NaCl", "KOH"],
        "correct": 0,
        "category": "علمي"
    },
    {
        "question": "في أي دولة يقع مضيق هرمز؟",
        "options": ["بين إيران وعُمان", "بين قطر والسعودية", "بين البحرين والكويت", "بين العراق والأردن"],
        "correct": 0,
        "category": "جغرافي"
    },
    {
        "question": "ما اسم القانون الذي ينص على أن الضغط يتناسب عكسيًا مع الحجم؟",
        "options": ["قانون بويل", "قانون شارل", "قانون نيوتن", "قانون أوم"],
        "correct": 0,
        "category": "علمي"
    },
    {
        "question": "كم عدد الأئمة المعصومين في المذهب الشيعي؟",
        "options": ["12", "10", "14", "11"],
        "correct": 0,
        "category": "ديني"
    },
    {
        "question": "أي مما يلي يُعد قارة؟",
        "options": ["أنتاركتيكا", "جرينلاند", "القطب الشمالي", "أوروبا الشرقية"],
        "correct": 0,
        "category": "جغرافي"
    },
    {
        "question": "ما هو الغاز المسؤول عن ظاهرة الاحتباس الحراري؟",
        "options": ["ثاني أكسيد الكربون", "النيتروجين", "الأوزون", "الأكسجين"],
        "correct": 0,
        "category": "علمي"
    },
    {
        "question": "أي من الأمور التالية يوجب الغُسل عند الشيعة؟",
        "options": ["الجنابة", "الوضوء", "الحيض فقط", "النجاسة"],
        "correct": 0,
        "category": "ديني"
    },
    {
        "question": "أين تقع سلسلة جبال زاجروس؟",
        "options": ["إيران والعراق", "تركيا وسوريا", "اليمن والسعودية", "أفغانستان وباكستان"],
        "correct": 0,
        "category": "جغرافي"
    },
    {
        "question": "من هو النبي الذي ابتلعه الحوت؟",
        "options": ["يونس", "موسى", "عيسى", "إبراهيم"],
        "correct": 0,
        "category": "ديني"
    },
    {
        "question": "أي كوكب يُعرف بالكوكب الأحمر؟",
        "options": ["المريخ", "الزهرة", "عطارد", "نبتون"],
        "correct": 0,
        "category": "علمي"
    },
    {
        "question": "ما هو الحيوان الذي لا يملك حبالًا صوتية؟",
        "options": ["الزرافة", "الفيل", "التمساح", "النمر"],
        "correct": 0,
        "category": "علمي"
    },
    {
        "question": "ما هي السورة التي تعادل ثلث القرآن؟",
        "options": ["الإخلاص", "الفاتحة", "البقرة", "الكوثر"],
        "correct": 0,
        "category": "ديني"
    },
    {
        "question": "أين تقع جبال الأطلس؟",
        "options": ["المغرب", "تركيا", "إيران", "السودان"],
        "correct": 0,
        "category": "جغرافي"
    },
    {
        "question": "ما هو المركب الكيميائي للماء؟",
        "options": ["H2O", "CO2", "NaCl", "O2"],
        "correct": 0,
        "category": "علمي"
    },
    {
        "question": "من هو الإمام الذي دُفن في سامراء؟",
        "options": ["الإمام الهادي", "الإمام الجواد", "الإمام الكاظم", "الإمام السجاد"],
        "correct": 0,
        "category": "ديني"
    },
    {
        "question": "ما اسم العملية التي يتحول فيها السائل إلى غاز؟",
        "options": ["التبخر", "التكاثف", "الانصهار", "التجمد"],
        "correct": 0,
        "category": "علمي"
    },
    {
        "question": "في أي قارة تقع الأرجنتين؟",
        "options": ["أمريكا الجنوبية", "أوروبا", "أفريقيا", "آسيا"],
        "correct": 0,
        "category": "جغرافي"
    },
    {
        "question": "من هو الإمام الذي قال: 'لو علم الناس ما في فضل زيارة الحسين لماتوا شوقًا'؟",
        "options": ["الإمام الصادق", "الإمام الباقر", "الإمام الكاظم", "الإمام الرضا"],
        "correct": 0,
        "category": "ديني"
    },{
        "question": "ما هو العدد الذري للهيدروجين؟",
        "options": ["1", "2", "3", "4"],
        "correct": 0,
        "category": "علمي"
    },
    {
        "question": "ما هي وحدة قياس المقاومة الكهربائية؟",
        "options": ["فولت", "أوم", "أمبير", "واط"],
        "correct": 1,
        "category": "علمي"
    },
    {
        "question": "ما هو قانون نيوتن الأول؟",
        "options": ["قانون الجذب العام", "قانون الحركة", "قانون التبريد", "قانون الديناميكا الحرارية"],
        "correct": 1,
        "category": "علمي"
    },
    {
        "question": "ما هي الصيغة الكيميائية للماء؟",
        "options": ["CO2", "H2O", "NaCl", "O2"],
        "correct": 1,
        "category": "علمي"
    },
    {
        "question": "ما هو حل المعادلة: x² - 9 = 0؟",
        "options": ["3 و -3", "9 و -9", "0 و 9", "1 و -1"],
        "correct": 0,
        "category": "علمي"
    },
    {
        "question": "ما هو الغاز الأكثر وفرة في الغلاف الجوي؟",
        "options": ["الأكسجين", "ثاني أكسيد الكربون", "النيتروجين", "الهيدروجين"],
        "correct": 2,
        "category": "علمي"
    },
    {
        "question": "ما هي أسرع حيوان بري؟",
        "options": ["الفهد", "الأسد", "الغزال", "النمر"],
        "correct": 0,
        "category": "علمي"
    },
    {
        "question": "ما هي قيمة π (باي) التقريبية؟",
        "options": ["2.14", "3.14", "4.14", "1.14"],
        "correct": 1,
        "category": "علمي"
    },
    {
        "question": "ما هو العنصر الكيميائي الذي رمزه 'Fe'؟",
        "options": ["الفضة", "الفلور", "الحديد", "الرصاص"],
        "correct": 2,
        "category": "علمي"
    },
    {
        "question": "ما هي وحدة قياس شدة التيار الكهربائي؟",
        "options": ["فولت", "أوم", "أمبير", "واط"],
        "correct": 2,
        "category": "علمي"
    },

    # أسئلة ثقافية 📚 (25 سؤال)
    {
        "question": "من هو مكتشف الجاذبية الأرضية؟",
        "options": ["ألبرت أينشتاين", "إسحاق نيوتن", "جاليليو جاليلي", "نيكولا تسلا"],
        "correct": 1,
        "category": "ثقافي"
    },
    {
        "question": "ما هي اللغة الرسمية في البرازيل؟",
        "options": ["الإسبانية", "البرتغالية", "الإنجليزية", "الفرنسية"],
        "correct": 1,
        "category": "ثقافي"
    },
    {
        "question": "من هو مؤلف مسرحية 'هاملت'؟",
        "options": ["ويليام شكسبير", "جورج برنارد شو", "أنطون تشيخوف", "تشارلز ديكنز"],
        "correct": 0,
        "category": "ثقافي"
    },
    {
        "question": "ما هو أطول نهر في العالم؟",
        "options": ["نهر النيل", "نهر الأمازون", "نهر المسيسيبي", "نهر اليانغتسي"],
        "correct": 1,
        "category": "ثقافي"
    },
    {
        "question": "من رسم لوحة الموناليزا؟",
        "options": ["فان جوخ", "بابلو بيكاسو", "ليوناردو دا فينشي", "سلفادور دالي"],
        "correct": 2,
        "category": "ثقافي"
    },

    # المزيد من الأسئلة المختلطة...
    {
        "question": "ما هو العدد التالي في المتتالية: 2, 4, 8, 16, ...؟",
        "options": ["20", "24", "32", "64"],
        "correct": 2,
        "category": "علمي"
    },
    {
        "question": "من هو مخترع التلفون؟",
        "options": ["توماس إديسون", "غراهام بيل", "نيكولا تسلا", "ماركوني"],
        "correct": 1,
        "category": "ثقافي"
    },
    {
        "question": "ما هي عاصمة اليابان؟",
        "options": ["أوساكا", "كيوتو", "طوكيو", "هيروشيما"],
        "correct": 2,
        "category": "ثقافي"
    },
    {
        "question": "ما هو أصغر عدد أولي؟",
        "options": ["0", "1", "2", "3"],
        "correct": 2,
        "category": "علمي"
    },
    {
        "question": "من هو عالم الفيزياء المشهور بنظريته النسبية؟",
        "options": ["نيوتن", "أينشتاين", "تسلا", "بور"],
        "correct": 1,
        "category": "ثقافي"
    },  {
        "question": "من هو مكتشف الجاذبية الأرضية؟",
        "options": ["ألبرت أينشتاين", "إسحاق نيوتن", "جاليليو جاليلي", "نيكولا تسلا"],
        "correct": 1,
        "category": "ثقافي"
    },
    {
        "question": "ما هي اللغة الرسمية في البرازيل؟",
        "options": ["الإسبانية", "البرتغالية", "الإنجليزية", "الفرنسية"],
        "correct": 1,
        "category": "ثقافي"
    },
    {
        "question": "من هو مؤلف مسرحية 'هاملت'؟",
        "options": ["ويليام شكسبير", "جورج برنارد شو", "أنطون تشيخوف", "تشارلز ديكنز"],
        "correct": 0,
        "category": "ثقافي"
    },
    {
        "question": "ما هو أطول نهر في العالم؟",
        "options": ["نهر النيل", "نهر الأمازون", "نهر المسيسيبي", "نهر اليانغتسي"],
        "correct": 1,
        "category": "ثقافي"
    },
    {
        "question": "من رسم لوحة الموناليزا؟",
        "options": ["فان جوخ", "بابلو بيكاسو", "ليوناردو دا فينشي", "سلفادور دالي"],
        "correct": 2,
        "category": "ثقافي"
    },

    # أسئلة علمية 🔬 (50 سؤال)
    {
        "question": "ما هو العدد الذري للهيدروجين؟",
        "options": ["1", "2", "3", "4"],
        "correct": 0,
        "category": "علمي"
    },
    {
        "question": "ما هي وحدة قياس المقاومة الكهربائية؟",
        "options": ["فولت", "أوم", "أمبير", "واط"],
        "correct": 1,
        "category": "علمي"
    },
    {
        "question": "ما هو رمز عنصر الذهب في الجدول الدوري؟",
        "options": ["Ag", "Au", "Fe", "Cu"],
        "correct": 1,
        "category": "علمي"
    },
    {
        "question": "ما هي الصيغة الكيميائية للماء؟",
        "options": ["CO2", "H2O", "NaCl", "O2"],
        "correct": 1,
        "category": "علمي"
    },
    {
        "question": "ما هو قانون نيوتن الأول؟",
        "options": ["قانون الجذب العام", "قانون الحركة", "قانون التبريد", "قانون الديناميكا الحرارية"],
        "correct": 1,
        "category": "علمي"
    },

    # استمرار الأسئلة المختلطة...
    {
        "question": "من هو مؤسس نظرية التطور؟",
        "options": ["لويس باستور", "تشارلز داروين", "جريجور مندل", "ألفريد والاس"],
        "correct": 1,
        "category": "ثقافي"
    },
    {
        "question": "ما هو حل المعادلة التربيعية: x² - 5x + 6 = 0؟",
        "options": ["2 و 3", "1 و 6", "-2 و -3", "5 و 1"],
        "correct": 0,
        "category": "علمي"
    },
    {
        "question": "ما هي عاصمة أستراليا؟",
        "options": ["سيدني", "ملبورن", "كانبرا", "بريزبن"],
        "correct": 2,
        "category": "ثقافي"
    },
    {
        "question": "ما هو الغاز المسؤول عن ظاهرة الاحتباس الحراري؟",
        "options": ["الأكسجين", "ثاني أكسيد الكربون", "النيتروجين", "الهيدروجين"],
        "correct": 1,
        "category": "علمي"
    },
    {
        "question": "من هو مخترع المصباح الكهربائي؟",
        "options": ["توماس إديسون", "نيكولا تسلا", "ألكسندر جراهام بيل", "جورج وستنجهاوس"],
        "correct": 0,
        "category": "ثقافي"
    },

    # المزيد من الأسئلة...
    {
        "question": "ما هي قيمة جيب الزاوية 30 درجة؟",
        "options": ["0.5", "√3/2", "1/√2", "1"],
        "correct": 0,
        "category": "علمي"
    },
    {
        "question": "ما هو أصل كلمة 'ألجبرا'؟",
        "options": ["يوناني", "لاتيني", "عربي", "فارسي"],
        "correct": 2,
        "category": "ثقافي"
    },
    {
        "question": "ما هي أسرع حيوان بري؟",
        "options": ["الفهد", "الأسد", "الغزال", "النمر"],
        "correct": 0,
        "category": "علمي"
    },
    {
        "question": "ما هو العنصر الكيميائي الذي رمزه 'Na'؟",
        "options": ["النيكل", "الصوديوم", "النيون", "النيتروجين"],
        "correct": 1,
        "category": "علمي"
    },
    {
        "question": "من هو مؤلف كتاب 'الأصول' في الرياضيات؟",
        "options": ["أرخميدس", "إقليدس", "فيثاغورس", "ديكارت"],
        "correct": 1,
        "category": "ثقافي"
    }
]


# QURAN_QUESTIONS مباشرة (حوالي السطر 500)
QURAN_QUESTIONS = [
    {
        "question": "ما معنى كلمة 'الصمد' في سورة الإخلاص؟",
        "options": ["السيد الذي انتهى إليه السؤدد", "الأحد", "القوي", "العظيم"],
        "correct": 0,
        "category": "معاني الكلمات"
    },
    {
        "question": "في أي سورة وردت آية الكرسي؟",
        "options": ["البقرة", "آل عمران", "النساء", "المائدة"],
        "correct": 0,
        "category": "علوم القرآن"
    },
    {
        "question": "ما هو حكم النون الساكنة إذا جاء بعدها حرف الراء؟",
        "options": ["إدغام بغنة", "إدغام بغير غنة", "إظهار", "إخفاء"],
        "correct": 1,
        "category": "تجويد"
    },
    {
        "question": "كم عدد آيات سورة الفاتحة؟",
        "options": ["7", "6", "8", "5"],
        "correct": 0,
        "category": "علوم القرآن"
    },
    {
        "question": "ما معنى كلمة 'الكوثر'؟",
        "options": ["الخير الكثير", "النهر", "الجنة", "النور"],
        "correct": 0,
        "category": "معاني الكلمات"
    },
    {
        "question": "ما حكم النون الساكنة في كلمة 'مِن رَّبِّهِمۡ' (البقرة: 5)؟",
        "options": ["إظهار", "إدغام بغير غنة", "إخفاء", "إقلاب"],
        "correct": 1,
        "category": "تجويد",
        "ref": "سورة البقرة - الآية 5"
    },
    {
        "question": "كم مرة ذكر اسم 'علي' صريحاً في القرآن؟",
        "options": ["0", "1", "2", "3"],
        "correct": 0,
        "category": "علوم القرآن"
    },
    {
        "question": "ما معنى 'العلق' في سورة العلق؟",
        "options": ["الدم المتجمد", "الدودة", "الجرح", "الكتاب"],
        "correct": 0,
        "category": "معاني الكلمات"
    },
    {
        "question": "ما السورة التي تسمى 'قلب القرآن'؟",
        "options": ["يس", "الرحمن", "الواقعة", "الكهف"],
        "correct": 0,
        "category": "علوم القرآن"
    },
    {
        "question": "ما هي السورة التي تسمى 'عروس القرآن'؟",
        "options": ["الرحمن", "الواقعة", "يس", "الدخان"],
        "correct": 0,
        "category": "علوم القرآن"
    },
    {
        "question": "ما سبب نزول آية 'إِنَّمَا وَلِيُّكُمُ ٱللَّهُ' (المائدة: 55)؟",
        "options": ["بسبب تصدق الإمام علي وهو راكع", "بسبب غزوة بدر", "بسبب بيعة الغدير", "بسبب فتح مكة"],
        "correct": 0,
        "category": "أسباب النزول"
    },
    {
        "question": "كم عدد أحزاب القرآن؟",
        "options": ["60", "30", "120", "7"],
        "correct": 0,
        "category": "علوم القرآن"
    },
    {
        "question": "ما حكم النون الساكنة في 'ٱلۡإِنسَٰنَ' (العصر: 2)؟",
        "options": ["إخفاء", "إدغام", "إظهار", "إقلاب"],
        "correct": 0,
        "category": "تجويد",
        "ref": "سورة العصر - الآية 2"
    },
    {
        "question": "ما سبب نزول سورة المسد؟",
        "options": ["بسبب أبي لهب وزوجته", "بسبب فرعون", "بسبب قارون", "بسبب أبي جهل"],
        "correct": 0,
        "category": "أسباب النزول"
    },
    {
        "question": "ما هي أقصر سورة في القرآن؟",
        "options": ["الكوثر", "العصر", "النصر", "الإخلاص"],
        "correct": 0,
        "category": "علوم القرآن"
    },
    {
        "question": "ما حكم النون الساكنة في ' قُمۡ فَأَنذِرۡ ' (المدثر: 2)؟",
        "options": ["إقلاب", "إدغام بغنة", "إظهار", "إخفاء"],
        "correct": 3,
        "category": "تجويد",
        "ref": "سورة المدثر - الآية 2"
    },
    {
        "question": "ما هي السورة التي تسمى 'المنجية'؟",
        "options": ["الملك", "الواقعة", "يس", "الدخان"],
        "correct": 0,
        "category": "علوم القرآن"
    },
    {
        "question": "ما معنى 'الغاشية' في سورة الغاشية؟",
        "options": ["القيامة", "النار", "الصيحة", "العذاب"],
        "correct": 0,
        "category": "معاني الكلمات"
    },
    {
        "question": "ما هي السورة التي تسمى 'المسبحات'؟",
        "options": ["الحديد والحشر والصف", "الرحمن والواقعة والملك", "يس والدخان والجن", "الفاتحة والبقرة وآل عمران"],
        "correct": 0,
        "category": "علوم القرآن"
    },
    {
        "question": "ما حكم النون الساكنة في 'مِن دَابَّةٍ' (النور: 45)？",
        "options": ["إقلاب", "إدغام بغنة", "إظهار", "إخفاء"],
        "correct": 3,
        "category": "تجويد",
        "ref": "سورة النور - الآية 45"
    },
    {
        "question": "ما معنى 'النبأ' في سورة النبأ؟",
        "options": ["الخبر العظيم", "الوحي", "القيامة", "الرسول"],
        "correct": 0,
        "category": "معاني الكلمات"
    },
    {
        "question": "ما حكم النون الساكنة في 'مِن رَّحۡمَةٍ' (الحديد: 28)？",
        "options": ["إقلاب", "إدغام بغيرغنة", "إظهار", "إخفاء"],
        "correct": 1,
        "category": "تجويد",
        "ref": "سورة الحديد - الآية 28"
    },
    {
    {
        "question": "ما معنى 'الحطمة' في سورة الهمزة؟",
        "options": ["النار", "الزلزال", "الصيحة", "القبر"],
        "correct": 0,
        "category": "معاني الكلمات"
    },
    {
        "question": "ما معنى 'الواقعة' في سورة الواقعة؟",
        "options": ["القيامة", "الزلزلة", "الصيحة", "البعث"],
        "correct": 0,
        "category": "معاني الكلمات"
    },
    {
        "question": "ما هي السورة التي تسمى 'المقشقشة'؟",
        "options": ["الكافرون", "الفاتحة", "الضحى", "النور"],
        "correct": 0,
        "category": "علوم القرآن"
    }
]

# ---------------------- Helper Functions ----------------------
def save_data():
    data = {
        'mentioned_users': mentioned_users,
        'user_activities': user_activities,
        'user_points': user_points,
        'reminders': reminders
    }
    with open('bot_data.json', 'w', encoding='utf-8') as f:
        json.dump(data, f, ensure_ascii=False, indent=2)

def load_data():
    global mentioned_users, user_activities, user_points, reminders
    try:
        with open('bot_data.json', 'r', encoding='utf-8') as f:
            data = json.load(f)
            mentioned_users = data.get('mentioned_users', {})
            user_activities = data.get('user_activities', {})
            user_points = data.get('user_points', {})
            reminders = data.get('reminders', {})
    except (FileNotFoundError, json.JSONDecodeError):
        mentioned_users = {}
        user_activities = {}
        user_points = {}
        reminders = {}

def record_activity(user_id: int, username: str, chat_id: int):
    today = datetime.datetime.now().strftime('%Y-%m-%d')
    chat_id = str(chat_id)
    user_id = str(user_id)

    if chat_id not in user_activities:
        user_activities[chat_id] = {}

    if user_id not in user_activities[chat_id]:
        user_activities[chat_id][user_id] = {'username': username, 'activities': {}}

    if today not in user_activities[chat_id][user_id]['activities']:
        user_activities[chat_id][user_id]['activities'][today] = 0

    user_activities[chat_id][user_id]['activities'][today] += 1
    save_data()

# ---------------------- Command Handlers ----------------------
async def start(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    await update.message.reply_text(
        "🏮 **أهلاً وسهلاً!**\n"
        "هذا البوت يقدم خدمات التذكير والمسابقات.\n"
        "استخدم /help لعرض الأوامر المتاحة."
    )
    record_activity(update.effective_user.id, 
                   update.effective_user.username or update.effective_user.first_name, 
                   update.effective_chat.id)

async def help_command(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    help_text = """
    🏆 **قائمة الأوامر:** 

    - `/start` : رسالة ترحيبية
    - `/help` : عرض هذه الرسالة
    - `/mention` : عمل منشن للجميع
    - `/active` : عرض أكثر الأعضاء تفاعلاً
    - `/remind` : ضبط تذكير
    - `/mcq` : أسئلة اختيار من متعدد
    - `/quranQ` : أسئلة قرآنية
    - `/monthly` : عرض تفاعل الشهر
    - `/champ` : مسابقة جماعية
    - `/points` : عرض النقاط
    """
    await update.message.reply_text(help_text, parse_mode='Markdown')
    record_activity(update.effective_user.id, 
                   update.effective_user.username or update.effective_user.first_name, 
                   update.effective_chat.id)

async def mention(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    # اختيار رسالة عشوائية
    random_phrase = random.choice(MENTION_PHRASES)

    # تقسيم المستخدمين إلى مجموعات من 5
    group_size = 5
    user_groups = [MENTION_USERS[i:i + group_size] for i in range(0, len(MENTION_USERS), group_size)]

    for group in user_groups:
        # إنشاء نص المجموعة
        group_mentions = " ".join(group)

        # تكوين الرسالة
        message_text = random_phrase.format(users=group_mentions)

        try:
            # إرسال الرسالة بدون parse_mode
            await update.message.reply_text(message_text)
            # تأخير بسيط بين الرسائل
            await asyncio.sleep(1)
        except Exception as e:
            print(f"Error in mention: {e}")

    record_activity(update.effective_user.id,
                   update.effective_user.username or update.effective_user.first_name,
                   update.effective_chat.id)

async def active(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    chat_id = str(update.effective_chat.id)

    if chat_id not in user_activities or not user_activities[chat_id]:
        await update.message.reply_text("❗ مافي تفاعل مسجل لهذه المجموعة!")
        return

    # Calculate last week's date
    today = datetime.datetime.now()
    week_ago = today - datetime.timedelta(days=7)

    # Collect weekly activity
    weekly_activity = {}
    for user_id, data in user_activities[chat_id].items():
        username = data['username']
        activities = data['activities']

        total = 0
        for date_str, count in activities.items():
            date = datetime.datetime.strptime(date_str, '%Y-%m-%d')
            if date >= week_ago:
                total += count

        weekly_activity[user_id] = {'username': username, 'count': total}

    # Sort by activity
    sorted_users = sorted(weekly_activity.items(), key=lambda x: x[1]['count'], reverse=True)

    if not sorted_users:
        await update.message.reply_text("❗ مافي تفاعل خلال الأسبوع الماضي!")
        return

    # Prepare activity message
    activity_msg = "🏆 أكثر الأعضاء تفاعلاً خلال الأسبوع 🏆\n\n"

    for i, (user_id, data) in enumerate(sorted_users):
        username = data['username']
        count = data['count']

        if count == 0:
            continue

        if i == 0:
            emoji = "👑"
            phrase = random.choice(["ملك التفاعل!", "هذا سيد التفاعل!", "أكثر واحد متفاعل!"])
        elif i == 1:
            emoji = "🔥"
            phrase = random.choice(["شعلة تفاعل!", "نار والله!", "ثاني ملك تفاعل!"])
        elif i == 2:
            emoji = "⭐"
            phrase = random.choice(["شاطر والله!", "متفاعل مره!", "ثالث الوصول!"])
        else:
            emoji = random.choice(["👍", "🙂", "👌"])
            phrase = random.choice(["استمر يا بطل", "دوم التفاعل", "نشاطك حلو"])

        activity_msg += f"{emoji} {username}: {count} مشاركة - {phrase}\n"

    # Send without Markdown parsing
    await update.message.reply_text(activity_msg)
    record_activity(update.effective_user.id, 
                   update.effective_user.username or update.effective_user.first_name, 
                   chat_id)

async def remind(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    chat_id = update.effective_chat.id
    user_id = update.effective_user.id
    message_text = update.message.text

    if len(message_text.split(' ', 1)) < 2:
        examples = [
            "🚀 **أمثلة على الاستخدام الصحيح:**",
            "1. `/remind 5:30 PM اشرب الدواء`",
            "2. `/remind السنة الجاية تذكرني بشراء الهدايا`",
            "3. `/remind 8:00 AM قم للمذاكرة`"
        ]
        await update.message.reply_text(
            "الرجاء استخدام الصيغة الصحيحة:\n" + "\n".join(examples),
            parse_mode='Markdown'
        )
        return

    reminder_text = message_text.split(' ', 1)[1]

    try:
        saudi_tz = pytz.timezone('Asia/Riyadh')
        now = datetime.datetime.now(saudi_tz)

        if 'السنة الجاية' in reminder_text:
            next_year = now.year + 1
            reminder_time = now.replace(year=next_year, hour=12, minute=0, second=0)
            user_message = reminder_text.replace('السنة الجاية', '').strip()
        else:
            time_match = re.search(r'(\d{1,2}):(\d{2})\s*(AM|PM)?', reminder_text, re.IGNORECASE)
            if not time_match:
                raise ValueError("تنسيق الوقت غير صحيح. استخدم HH:MM AM/PM")

            hour = int(time_match.group(1))
            minute = int(time_match.group(2))
            period = time_match.group(3).upper() if time_match.group(3) else None

            if period == "PM" and hour < 12:
                hour += 12
            elif period == "AM" and hour == 12:
                hour = 0

            reminder_time = now.replace(hour=hour, minute=minute, second=0)
            user_message = reminder_text.replace(time_match.group(0), '').strip()

        if chat_id not in reminders:
            reminders[chat_id] = []

        reminders[chat_id].append({
            'user_id': user_id,
            'time': reminder_time.timestamp(),
            'message': user_message
        })

        save_data()

        formatted_time = reminder_time.strftime('%Y/%m/%d %H:%M')
        await update.message.reply_text(
            f"⏰ تم ضبط التذكير!\n"
            f"📅 التاريخ: {formatted_time}\n"
            f"📝 الرسالة: {user_message}"
        )

        context.job_queue.run_once(
            send_reminder,
            (reminder_time - datetime.datetime.now(saudi_tz)).total_seconds(),
            data={'chat_id': chat_id, 'user_id': user_id, 'message': user_message}
        )

    except Exception as e:
        await update.message.reply_text(f"❌ خطأ: {str(e)}")

    record_activity(user_id, 
                   update.effective_user.username or update.effective_user.first_name, 
                   chat_id)

async def send_reminder(context):
    job = context.job
    chat_id = job.data['chat_id']
    user_id = job.data['user_id']
    message = job.data['message']

    try:
        user_mention = f"[صديقي](tg://user?id={user_id})"
        reminder_message = f"⏰ هلا {user_mention}! جيت أذكرك: {message}"
        await context.bot.send_message(chat_id=chat_id, text=reminder_message, parse_mode='Markdown')

        if chat_id in reminders:
            reminders[chat_id] = [r for r in reminders[chat_id] if not (r['user_id'] == user_id and r['message'] == message)]
            save_data()

    except Exception as e:
        print(f"خطأ في إرسال التذكير: {e}")

async def mcq(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    chat_id = update.effective_chat.id
    # Get a random question and shuffle its options
    question = random.choice(shuffle_question_options(MCQ_QUESTIONS))
    last_questions[chat_id] = question
    # ... rest of the function remains the same

    keyboard = []
    for i, option in enumerate(question['options']):
        keyboard.append([InlineKeyboardButton(option, callback_data=f"mcq_{i}")])

    keyboard.append([InlineKeyboardButton("أظهر الإجابة", callback_data="mcq_show_answer")])
    reply_markup = InlineKeyboardMarkup(keyboard)

    category_emoji = {
        "ديني": "🕌",
        "جغرافي": "🌍",
        "علمي": "🔬",
        "ثقافي": "📚"
    }

    emoji = category_emoji.get(question['category'], "❓")

    await update.message.reply_text(
        f"{emoji} *سؤال {question['category']}*\n\n{question['question']}\n\nاختر الإجابة الصحيحة:",
        reply_markup=reply_markup,
        parse_mode='Markdown'
    )
    record_activity(update.effective_user.id, 
                   update.effective_user.username or update.effective_user.first_name, 
                   chat_id)

async def champ(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    chat_id = update.effective_chat.id

    if chat_id in active_champs:
        await update.message.reply_text("❗ فيه مسابقة نشطة حالياً!")
        return

    # Get random questions and shuffle their options
    shuffled_questions = shuffle_question_options(random.sample(MCQ_QUESTIONS, 5))

    active_champs[chat_id] = {
        'questions': shuffled_questions,
        'current_q': 0,
        'answers': {},
        'participants': {},
        'message_id': None,
        'countdown_task': None
    }
    # ... rest of the function remains the same

    await send_champ_question(update, context, chat_id)
    record_activity(update.effective_user.id, 
                   update.effective_user.username or update.effective_user.first_name, 
                   chat_id)

async def send_champ_question(update: Update, context: ContextTypes.DEFAULT_TYPE, chat_id: int):
    champ_data = active_champs[chat_id]
    current_q = champ_data['current_q']
    question = champ_data['questions'][current_q]

    keyboard = []
    for i, option in enumerate(question['options']):
        keyboard.append([InlineKeyboardButton(option, callback_data=f"champ_{i}")])

    message = await context.bot.send_message(
        chat_id=chat_id,
        text=f"🏆 السؤال {current_q + 1}/5\n\n{question['question']}\n\n"
             f"👥 عدد المشاركين: 0\n"
             f"⏳ الوقت المتبقي: 15 ثانية\n\n"
             f"اختر إجابتك! ستظهر النتائج بعد انتهاء الوقت.",
        reply_markup=InlineKeyboardMarkup(keyboard)
    )

    champ_data['message_id'] = message.message_id

    # جدولة السؤال التالي
    context.job_queue.run_once(
        delete_and_next,
        15.0,
        data={'chat_id': chat_id, 'message_id': message.message_id}
    )

async def countdown_timer(context, chat_id, message_id):
    for remaining in range(10, 0, -1):
        await update_countdown(context, chat_id, message_id, remaining)
        await asyncio.sleep(1)

async def update_countdown(context, chat_id, message_id, remaining_time):
    champ_data = active_champs.get(chat_id)
    if not champ_data:
        return

    current_q = champ_data['current_q']
    question = champ_data['questions'][current_q]

    keyboard = []
    for i, option in enumerate(question['options']):
        keyboard.append([InlineKeyboardButton(option, callback_data=f"champ_{i}")])

    try:
        await context.bot.edit_message_text(
            chat_id=chat_id,
            message_id=message_id,
            text=f"🏆 **السؤال {current_q + 1}/5**\n\n{question['question']}\n\n⏳ الوقت المتبقي: {remaining_time} ثانية",
            reply_markup=InlineKeyboardMarkup(keyboard)
        )
    except:
        pass

async def delete_and_next(context):
    job = context.job
    chat_id = job.data['chat_id']
    message_id = job.data['message_id']

    try:
        await context.bot.delete_message(chat_id=chat_id, message_id=message_id)
    except:
        pass

    if chat_id in active_champs and active_champs[chat_id]['countdown_task']:
        active_champs[chat_id]['countdown_task'].cancel()
        try:
            await active_champs[chat_id]['countdown_task']
        except:
            pass

    await next_champ_question(context, chat_id)

async def next_champ_question(context, chat_id):
    champ_data = active_champs[chat_id]
    champ_data['current_q'] += 1

    if champ_data['current_q'] < 5:
        await send_champ_question(None, context, chat_id)
    else:
        await end_champ(context, chat_id)

async def champ_button_handler(update: Update, context: ContextTypes.DEFAULT_TYPE):
    query = update.callback_query
    chat_id = update.effective_chat.id
    user_id = query.from_user.id
    username = query.from_user.username or query.from_user.first_name

    if chat_id not in active_champs:
        await query.answer("المسابقة غير نشطة حالياً!", show_alert=True)
        return

    champ_data = active_champs[chat_id]
    question_idx = champ_data['current_q']
    answer_idx = int(query.data.split('_')[1])

    if user_id not in champ_data['answers']:
        champ_data['answers'][user_id] = [None] * 5
        champ_data['participants'][user_id] = username

    if champ_data['answers'][user_id][question_idx] is None:
        champ_data['answers'][user_id][question_idx] = answer_idx
        # إظهار رسالة للمستخدم فقط دون تغيير السؤال
        await query.answer(f"✅ تم تسجيل إجابتك للسؤال {question_idx + 1}!", show_alert=True)
    else:
        await query.answer("لقد أجبت على هذا السؤال مسبقاً!", show_alert=True)

    # إضافة عدد المشاركين الحاليين في نص السؤال
    current_participants = len([u for u in champ_data['answers'].values() if u[question_idx] is not None])
    question = champ_data['questions'][question_idx]

    keyboard = []
    for i, option in enumerate(question['options']):
        keyboard.append([InlineKeyboardButton(option, callback_data=f"champ_{i}")])

    try:
        await context.bot.edit_message_text(
            chat_id=chat_id,
            message_id=champ_data['message_id'],
            text=f"🏆 السؤال {question_idx + 1}/5\n\n{question['question']}\n\n"
                 f"👥 عدد المشاركين: {current_participants}\n"
                 f"⏳ انتظر السؤال التالي...",
            reply_markup=InlineKeyboardMarkup(keyboard)
        )
    except Exception as e:
        print(f"Error updating message: {e}")

async def end_champ(context, chat_id):
    champ_data = active_champs.pop(chat_id)
    results = {}

    for user_id, answers in champ_data['answers'].items():
        username = champ_data['participants'][user_id]
        points = sum(1 for i, ans in enumerate(answers) if ans == champ_data['questions'][i]['correct'])
        results[user_id] = {'username': username, 'points': points}

    sorted_results = sorted(results.items(), key=lambda x: x[1]['points'], reverse=True)

    result_text = "🏆 **نتائج المسابقة** 🏆\n\n"
    for i, (user_id, data) in enumerate(sorted_results):
        username = data['username']
        points = data['points']
        if i == 0:
            result_text += f"🥇 {username}: {points} نقطة - ملك المسابقة! 👑\n"
        elif i == 1:
            result_text += f"🥈 {username}: {points} نقطة - شاطر! 🔥\n"
        elif i == 2:
            result_text += f"🥉 {username}: {points} نقطة - كفو! 👍\n"
        else:
            result_text += f"👤 {username}: {points} نقطة - جيد! 😊\n"

    await context.bot.send_message(chat_id=chat_id, text=result_text)

async def button_handler(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    query = update.callback_query
    await query.answer()

    chat_id = update.effective_chat.id
    user_id = query.from_user.id
    username = query.from_user.username or query.from_user.first_name

    record_activity(user_id, username, chat_id)

    data = query.data

    # التحقق من نوع السؤال (MCQ أو قرآني)
    if not (data.startswith("mcq_") or data.startswith("quran_")):
        return

    if chat_id not in last_questions:
        await query.edit_message_text("انتهت صلاحية السؤال. استخدم الأمر لعرض سؤال جديد.")
        return

    question = last_questions[chat_id]

    # معالجة إظهار الإجابة
    if data == "mcq_show_answer" or data == "quran_show_answer":
        correct_option = question['correct']
        correct_text = question['options'][correct_option]
        await query.edit_message_text(
            f"سؤال: {question['question']}\n\nالإجابة الصحيحة هي: *{correct_text}*",
            parse_mode='Markdown'
        )
        return

    # معالجة الإجابة المختارة
    selected_option = int(data.split('_')[1])

    if selected_option == question['correct']:
        praise = random.choice(CORRECT_ANSWER_PHRASES)

        if chat_id not in user_points:
            user_points[chat_id] = {}

        if user_id not in user_points[chat_id]:
            user_points[chat_id][user_id] = {'username': username, 'points': 0}

        # إضافة نقطتين للأسئلة القرآنية ونقطة واحدة للـ MCQ
        points_to_add = 2 if data.startswith("quran_") else 1
        user_points[chat_id][user_id]['points'] += points_to_add
        user_points[chat_id][user_id]['username'] = username

        save_data()

        await query.edit_message_text(
            f"✅ {praise}\n\n{username} كسب {points_to_add} نقطة!\nالنقاط الحالية: {user_points[chat_id][user_id]['points']}"
        )
    else:
        incorrect = random.choice(WRONG_ANSWER_PHRASES)
        correct_option = question['correct']
        correct_text = question['options'][correct_option]

        await query.edit_message_text(
            f"❌ {incorrect}\n\nالإجابة الصحيحة هي: *{correct_text}*",
            parse_mode='Markdown'
        )

async def points(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    chat_id = update.effective_chat.id

    if chat_id not in user_points or not user_points[chat_id]:
        await update.message.reply_text("لا توجد نقاط مسجلة في هذه المجموعة بعد.")
        return

    sorted_users = sorted(user_points[chat_id].items(), key=lambda x: x[1]['points'], reverse=True)

    points_text = "🏆 *ترتيب الأعضاء حسب النقاط* 🏆\n\n"

    for i, (user_id, data) in enumerate(sorted_users):
        username = data['username']
        points = data['points']

        if i == 0:
            points_text += f"🥇 *{username}*: {points} نقطة - يا سلام عليك يا بطل! 👏\n"
        elif i == 1:
            points_text += f"🥈 *{username}*: {points} نقطة - شاطر ومتميز! 👌\n"
        elif i == 2:
            points_text += f"🥉 *{username}*: {points} نقطة - تستاهل كل خير! 👍\n"
        else:
            encouragement = [
                "حلو أدائك!",
                "استمر بالتقدم!",
                "بالتوفيق!",
                "راح توصل!",
                "نشوفك بالصدارة!",
                "همتك معانا!",
                "يا بطل!",
                "يلا شد حيلك!",
                "ماشي حالك!",
                "عاش من شافك!"
            ]
            points_text += f"• *{username}*: {points} نقطة - {random.choice(encouragement)}\n"

    await update.message.reply_text(points_text, parse_mode='Markdown')
    record_activity(update.effective_user.id, 
                   update.effective_user.username or update.effective_user.first_name, 
                   chat_id)

async def check_reminders(context):
    now = time.time()

    for chat_id, chat_reminders in reminders.items():
        for reminder in chat_reminders[:]:
            if reminder['time'] <= now:
                try:
                    user_id = reminder['user_id']
                    message = reminder['message']

                    user_mention = f"[صديقي](tg://user?id={user_id})"
                    reminder_message = f"⏰ هلا {user_mention}! جيت أذكرك: {message}"
                    await context.bot.send_message(chat_id=chat_id, text=reminder_message, parse_mode='Markdown')

                    reminders[chat_id].remove(reminder)
                    save_data()

                except Exception as e:
                    print(f"خطأ في إرسال التذكير: {e}")

async def handle_message(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """Record user activity for regular messages"""
    user = update.effective_user
    chat_id = update.effective_chat.id
    record_activity(user.id, user.username or user.first_name, chat_id)

async def unknown_command(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """Handle unknown commands"""
    command = update.message.text.split()[0]
    if command.startswith('/'):
        await update.message.reply_text(f"الأمر {command} غير معروف. استخدم /help للمساعدة.")



async def quranQ(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    chat_id = update.effective_chat.id
    # Get a random question and shuffle its options
    question = random.choice(shuffle_question_options(QURAN_QUESTIONS))
    last_questions[chat_id] = question
    # ... rest of the function remains the same

    keyboard = []
    for i, option in enumerate(question['options']):
        keyboard.append([InlineKeyboardButton(option, callback_data=f"quran_{i}")])

    reply_markup = InlineKeyboardMarkup(keyboard)

    category_emoji = {
        "معاني الكلمات": "📖",
        "أسباب النزول": "📜",
        "تجويد": "🎯",
        "علوم القرآن": "🌟"
    }

    emoji = category_emoji.get(question['category'], "📚")

    await update.message.reply_text(
        f"{emoji} *سؤال في {question['category']}*\n\n{question['question']}\n\nاختر الإجابة الصحيحة:",
        reply_markup=reply_markup,
        parse_mode='Markdown'
    )
    record_activity(update.effective_user.id, 
                   update.effective_user.username or update.effective_user.first_name, 
                   chat_id)

# Remove the duplicate monthly function definition and keep just this one:
async def monthly(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    chat_id = str(update.effective_chat.id)

    if chat_id not in user_activities or not user_activities[chat_id]:
        await update.message.reply_text("❗ لا يوجد تفاعل مسجل لهذا الشهر!")
        return

    # Get current month data
    now = datetime.datetime.now()
    month_start = now.replace(day=1, hour=0, minute=0, second=0, microsecond=0)

    # Get Arabic month name
    arabic_months = {
        1: "يناير", 2: "فبراير", 3: "مارس", 4: "إبريل",
        5: "مايو", 6: "يونيو", 7: "يوليو", 8: "أغسطس",
        9: "سبتمبر", 10: "أكتوبر", 11: "نوفمبر", 12: "ديسمبر"
    }

    current_month = arabic_months[now.month]

    # Collect monthly activity
    monthly_activity = {}
    for user_id, data in user_activities[chat_id].items():
        username = data['username']
        activities = data['activities']

        total = 0
        for date_str, count in activities.items():
            date = datetime.datetime.strptime(date_str, '%Y-%m-%d')
            if date >= month_start:
                total += count

        monthly_activity[user_id] = {'username': username, 'count': total}

    # Sort by activity
    sorted_users = sorted(monthly_activity.items(), key=lambda x: x[1]['count'], reverse=True)

    if not sorted_users:
        await update.message.reply_text(f"❗ لا يوجد تفاعل خلال شهر {current_month}!")
        return

    # Prepare message
    activity_msg = f"📊 *المتفاعلون خلال شهر {current_month}* 📊\n\n"

    for i, (user_id, data) in enumerate(sorted_users):
        username = data['username']
        count = data['count']

        if count == 0:
            continue

        if i == 0:
            emoji = "👑"
            phrases = [f"ملك شهر {current_month}!", "أسطورة هذا الشهر!", "نجم الشهر!"]
        elif i == 1:
            emoji = "🥈"
            phrases = ["تفاعل رائع!", "مجهود جبار!", "استمر على هذا المستوى!"]
        elif i == 2:
            emoji = "🥉"
            phrases = ["تستاهل كل خير!", "جهد مميز!", "فخورين فيك!"]
        elif i <= 5:
            emoji = "⭐"
            phrases = ["أداء جميل!", "واصل تقدمك!", "نشاط ملحوظ!"]
        else:
            emoji = "👍"
            phrases = ["شكراً على تفاعلك!", "استمر!", "كل التوفيق!"]

        phrase = random.choice(phrases)
        activity_msg += f"{emoji} *{username}*: {count} مشاركة - {phrase}\n"

    await update.message.reply_text(activity_msg, parse_mode='Markdown')
    record_activity(update.effective_user.id, 
                   update.effective_user.username or update.effective_user.first_name, 
                   chat_id)

def main() -> None:
    """
    الدالة الرئيسية لتشغيل البوت
    """
    # تحميل البيانات المحفوظة
    load_data()

    # تشغيل خادم Flask للحفاظ على حياة البوت
    keep_alive()

    # إنشاء تطبيق البوت مع التوكن
    application = ApplicationBuilder().token(BOT_TOKEN).build()

    # إضافة معالجات الأوامر الأساسية
    handlers = [
        CommandHandler("start", start),
        CommandHandler("help", help_command),
        CommandHandler("mention", mention),
        CommandHandler("active", active),
        CommandHandler("remind", remind),
        CommandHandler("mcq", mcq),
        CommandHandler("quranQ", quranQ),
        CommandHandler("monthly", monthly),
        CommandHandler("champ", champ),
        CommandHandler("points", points),
        
        # معالجات الأزرار
        CallbackQueryHandler(button_handler, pattern="^mcq_"),
        CallbackQueryHandler(button_handler, pattern="^quran_"),
        CallbackQueryHandler(champ_button_handler, pattern="^champ_"),
        
        # معالجات الرسائل
        MessageHandler(filters.TEXT & ~filters.COMMAND, handle_message),
        MessageHandler(filters.COMMAND, unknown_command)
    ]

    # إضافة جميع المعالجات للتطبيق
    for handler in handlers:
        application.add_handler(handler)

    # جدولة المهام الدورية
    job_queue = application.job_queue
    job_queue.run_repeating(check_reminders, interval=60, first=10)

    # تشغيل البوت باستخدام polling
    application.run_polling(allowed_updates=Update.ALL_TYPES)

if __name__ == "__main__":
    main()

from flask import Flask
from threading import Thread

app = Flask(__name__)

@app.route('/')
def home():
    return "Bot is alive!"

def run():
    app.run(host="0.0.0.0", port=int(os.getenv("PORT", 5000)))

def keep_alive():
    t = Thread(target=run)
    t.start()
